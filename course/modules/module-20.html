<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 20: Capstone — Full Pipeline</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9f9f9; padding: 20px; color: #444; line-height: 1.6; }
        h2 { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 8px; margin-bottom: 16px; }
        h3 { color: #764ba2; margin: 20px 0 10px; }
        .plain-terms { background: #f0f7ff; border-left: 4px solid #764ba2; padding: 15px; border-radius: 4px; margin: 16px 0; }
        .example-box { background: white; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; margin: 16px 0; }
        .step-box { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 18px; margin: 16px 0; }
        .info-box { background: #e8f4f8; border-left: 4px solid #667eea; padding: 15px; border-radius: 4px; margin: 16px 0; }
        .flow-step { background: #e8f0ff; border-left: 4px solid #667eea; padding: 10px 14px; border-radius: 4px; margin: 8px 0; }
        table { border-collapse: collapse; width: 100%; margin: 12px 0; }
        th { background: #667eea; color: white; padding: 10px; }
        td { padding: 10px; border: 1px solid #e0e0e0; }
        tr:nth-child(even) { background: #f8f9fa; }
        .quiz-section { background: white; border: 2px solid #667eea; border-radius: 8px; padding: 24px; margin-top: 24px; }
        .quiz-question { background: #f8f9fa; border-left: 4px solid #764ba2; padding: 16px; margin: 12px 0; border-radius: 4px; }
        .quiz-options { list-style: none; padding-left: 0; }
        .quiz-options li { background: white; border: 1px solid #ddd; padding: 10px; margin: 6px 0; border-radius: 6px; }
        .quiz-answer { display: none; border-left: 4px solid #28a745; padding: 12px; margin-top: 8px; background: #d4edda; border-radius: 4px; }
        .quiz-answer.show { display: block; }
        .show-answer-btn { background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-top: 8px; }
        .show-answer-btn:disabled { opacity: 0.7; cursor: not-allowed; background: #6c757d; }
        .diagram-box { background: #fff; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; margin: 20px 0; overflow-x: auto; }
        .diagram-box .diagram-title { font-weight: bold; color: #764ba2; margin-bottom: 12px; }
        .key-insight { background: linear-gradient(135deg, #f0f7ff 0%, #e8f0ff 100%); border-left: 4px solid #764ba2; padding: 18px 20px; border-radius: 6px; margin: 20px 0; font-size: 1.05em; line-height: 1.7; }
        .key-insight strong { color: #764ba2; }
        .key-takeaways { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; border-radius: 6px; margin: 24px 0; }
        .key-takeaways h4 { color: #155724; margin-top: 0; margin-bottom: 12px; font-size: 1.15em; }
        .key-takeaways ul { margin: 0; padding-left: 22px; }
        .key-takeaways li { margin-bottom: 8px; line-height: 1.6; }
        h4 { color: #667eea; margin: 14px 0 10px; font-size: 1em; }
        .code-block { margin: 16px 0; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; }
        .code-block .code-lang { background: #667eea; color: white; padding: 6px 12px; font-size: 0.85em; }
        .code-block pre { margin: 0; padding: 14px; background: #1e1e1e; color: #d4d4d4; font-size: 0.9em; overflow-x: auto; }
        .success-box { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; margin: 16px 0; }
    </style>
</head>
<body>
    <h2>Module 20: Capstone — Full Pipeline Project</h2>

    <h3>What the Capstone Covers</h3>
    <p>One end-to-end project: <strong>ingestion → Bronze → Silver → Gold → quality check → curated dataset → report</strong>. You use a single defined scenario (NorthStar Retail), the same dummy data used across the course, and produce a pipeline design doc, runnable code or config, one quality check, one curated output, and one report. The capstone ties every section together; the design doc and runbook make the pipeline maintainable, and the report answers a real business question that traces back to the pipeline.</p>

    <div class="key-insight">
        <strong>Key insight:</strong> The capstone is a single, concrete project—not a choice of scenarios. You build one pipeline from raw inputs to a dashboard, with clear phases and checkpoints. Design doc and runbook are required; the report is the proof that the pipeline delivers value.
    </div>

    <div class="diagram-box">
        <div class="diagram-title">Capstone: full pipeline end-to-end</div>
        <svg viewBox="0 0 620 75" xmlns="http://www.w3.org/2000/svg" style="max-width:100%;height:auto;">
            <defs><marker id="arr20" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#667eea"/></marker></defs>
            <rect x="5" y="22" width="65" height="35" rx="4" fill="#e8f4f8" stroke="#667eea"/><text x="37" y="42" text-anchor="middle" font-size="9">Ingest</text>
            <line x1="70" y1="39" x2="95" y2="39" stroke="#667eea" marker-end="url(#arr20)"/>
            <rect x="95" y="22" width="55" height="35" rx="4" fill="#cd7f32" stroke="#8B4513"/><text x="122" y="42" text-anchor="middle" font-size="9" fill="white">Bronze</text>
            <line x1="150" y1="39" x2="175" y2="39" stroke="#667eea" marker-end="url(#arr20)"/>
            <rect x="175" y="22" width="55" height="35" rx="4" fill="#C0C0C0" stroke="#808080"/><text x="202" y="42" text-anchor="middle" font-size="9">Silver</text>
            <line x1="230" y1="39" x2="255" y2="39" stroke="#667eea" marker-end="url(#arr20)"/>
            <rect x="255" y="22" width="55" height="35" rx="4" fill="#FFD700" stroke="#B8860B"/><text x="282" y="42" text-anchor="middle" font-size="9">Gold</text>
            <line x1="310" y1="39" x2="335" y2="39" stroke="#667eea" marker-end="url(#arr20)"/>
            <rect x="335" y="22" width="75" height="35" rx="4" fill="#e8f0ff" stroke="#667eea"/><text x="372" y="42" text-anchor="middle" font-size="9">Quality + Mart</text>
            <line x1="410" y1="39" x2="435" y2="39" stroke="#667eea" marker-end="url(#arr20)"/>
            <rect x="435" y="22" width="90" height="35" rx="4" fill="#d4edda" stroke="#28a745"/><text x="480" y="42" text-anchor="middle" font-size="9">Report</text>
        </svg>
    </div>

    <h3>Capstone scenario: NorthStar Retail (fixed)</h3>
    <p>Everyone builds the same pipeline so deliverables can be compared and reviewed. <strong>Business goal:</strong> Regional managers and sales leadership need a daily report of revenue and order count by product and region, fed by one certified dataset.</p>
    <p><strong>Sources:</strong> (1) A <strong>sales CSV</strong> dropped daily (e.g. <code>landing/sales/sales_YYYYMMDD.csv</code>) with columns: <code>sale_id</code>, <code>product_id</code>, <code>region_id</code>, <code>amount</code>, <code>sale_date</code>. (2) A <strong>product API</strong> (or static JSON) with <code>product_id</code>, <code>product_name</code>, <code>category</code>. You ingest both into a landing zone, then build Bronze → Silver → Gold. Gold = one row per (sale_date, product_id, region_id) with <code>revenue</code> (SUM amount), <code>order_count</code> (COUNT), and <code>product_name</code>. One validation rule: rows with <code>amount &lt; 0</code> or invalid <code>product_id</code> go to quarantine. One quality check after Gold: uniqueness on (sale_date, product_id, region_id). The curated output is the Gold table (or a mart view). The report (Power BI or Tableau) shows Total Revenue, Revenue by Region, and Revenue by Product, with a date/region filter.</p>

    <h4>Starter data (use this for the capstone)</h4>
    <p>Create or use these files so your pipeline has concrete inputs and expected outputs.</p>
    <div class="example-box">
        <p><strong>landing/sales/sales_20250108.csv</strong></p>
        <pre style="margin:0;padding:10px;background:#f5f5f5;border-radius:4px;font-size:0.85em;">sale_id,product_id,region_id,amount,sale_date
101,P1,North,29.99,2025-01-08
102,P2,South,14.50,2025-01-08
103,P1,North,29.99,2025-01-08
104,P3,West,49.00,2025-01-08</pre>
        <p><strong>landing/api_products/products.json</strong> (or equivalent)</p>
        <pre style="margin:0;padding:10px;background:#f5f5f5;border-radius:4px;font-size:0.85em;">[{"product_id":"P1","product_name":"Widget Pro","category":"Electronics"},
 {"product_id":"P2","product_name":"Basic Cable","category":"Accessories"},
 {"product_id":"P3","product_name":"Power Pack","category":"Electronics"}]</pre>
        <p><strong>Expected Gold (after your pipeline runs) for 2025-01-08:</strong></p>
        <table>
            <tr><th>sale_date</th><th>product_id</th><th>product_name</th><th>region_id</th><th>revenue</th><th>order_count</th></tr>
            <tr><td>2025-01-08</td><td>P1</td><td>Widget Pro</td><td>North</td><td>59.98</td><td>2</td></tr>
            <tr><td>2025-01-08</td><td>P2</td><td>Basic Cable</td><td>South</td><td>14.50</td><td>1</td></tr>
            <tr><td>2025-01-08</td><td>P3</td><td>Power Pack</td><td>West</td><td>49.00</td><td>1</td></tr>
        </table>
    </div>

    <h3>Capstone phases and tasks</h3>
    <p>Work through these phases in order. Each phase has concrete tasks and a checkpoint you can verify before moving on.</p>

    <h4>Phase 1: Design (design doc)</h4>
    <ul>
        <li><strong>1.1</strong> Write a short pipeline design doc (1–2 pages) that includes: <strong>Sources</strong> (sales CSV, product API); <strong>Landing</strong> (paths, format); <strong>Bronze</strong> (tables/files, append strategy, metadata columns); <strong>Silver</strong> (clean, dedup, join sales to product; grain: one row per sale line); <strong>Gold</strong> (grain: one row per sale_date, product_id, region_id; measures: revenue, order_count); <strong>Validation</strong> (rule: amount ≥ 0, product_id in product list; quarantine table); <strong>Quality check</strong> (uniqueness on Gold grain); <strong>Storage</strong> (where Gold lives); <strong>Refresh</strong> (daily, after sources land).</li>
        <li><strong>1.2</strong> Add one paragraph on <strong>failure/recovery</strong>: what happens if the CSV is missing or the API is down; who is alerted; how to backfill.</li>
    </ul>
    <div class="step-box"><p><strong>Checkpoint:</strong> Another person can read your design doc and understand the flow and where each piece of data lives.</p></div>

    <h4>Phase 2: Implementation (Bronze, Silver, Gold)</h4>
    <ul>
        <li><strong>2.1 Ingest and landing:</strong> Script or config that reads the sales CSV and product API (or JSON file) and writes them to a landing area. Run it with the starter data; confirm landing files exist.</li>
        <li><strong>2.2 Bronze:</strong> Code that copies landing data into Bronze (e.g. <code>bronze.sales_raw</code>, <code>bronze.products_raw</code>) with at least <code>_ingested_at</code>. Output: Bronze contains the same rows as landing plus metadata.</li>
        <li><strong>2.3 Silver:</strong> Code that cleans and deduplicates sales (e.g. by sale_id), joins sales to product to get product_name and category, and writes <code>silver.sales_enriched</code>. Route rows with amount &lt; 0 or invalid product_id to quarantine.</li>
        <li><strong>2.4 Gold:</strong> Code that aggregates Silver to Gold: one row per (sale_date, product_id, region_id, product_name) with SUM(amount) as revenue and COUNT(DISTINCT sale_id) as order_count. Run the full pipeline on the starter data and confirm Gold matches the expected table above.</li>
    </ul>
    <div class="step-box"><p><strong>Checkpoint:</strong> Given the starter CSV and products JSON, your pipeline produces exactly the expected Gold table.</p></div>

    <h4>Phase 3: Quality and curation</h4>
    <ul>
        <li><strong>3.1 Quality check:</strong> Implement one automated check after Gold: e.g. uniqueness on (sale_date, product_id, region_id) must return 0 duplicates. Document how it is wired and what happens when it fails.</li>
        <li><strong>3.2 Curated dataset:</strong> Define the curated output (Gold or mart view) and write a one-paragraph data dictionary (columns, grain, caveats).</li>
    </ul>

    <h4>Phase 4: Report</h4>
    <ul>
        <li><strong>4.1</strong> Build one report in Power BI or Tableau connected to Gold (or export). Include: KPI (Total Revenue, Total Orders); Revenue by Region; Revenue by Product; a filter (date/region); one DAX measure or calculated field (e.g. Revenue YoY % or Avg Revenue per Order).</li>
        <li><strong>4.2</strong> Fill out a one-page <strong>report card</strong>: purpose, audience, data source, refresh frequency, one improvement next.</li>
    </ul>
    <div class="step-box"><p><strong>Checkpoint:</strong> With the starter data, the report shows Total Revenue 123.48, Revenue by Region (North 59.98, South 14.50, West 49.00), and Revenue by Product (Widget Pro 59.98, Basic Cable 14.50, Power Pack 49.00). Numbers trace back to Gold.</p></div>

    <h4>Phase 5: Runbook and handoff</h4>
    <ul>
        <li><strong>5.1 Runbook:</strong> Document at least three items: (1) How to run the pipeline. (2) What to do if the sales CSV is missing or empty. (3) What to do if the quality check fails. Optionally: backfill a date; who to contact for source issues.</li>
        <li><strong>5.2 Handoff:</strong> One-paragraph pipeline summary for an analyst or new engineer: what the pipeline does, where the report gets its data, where to find the design doc and runbook.</li>
    </ul>

    <h3>Deliverables checklist</h3>
    <div class="example-box">
        <table>
            <tr><th>Deliverable</th><th>What to submit</th></tr>
            <tr><td>Design doc</td><td>1–2 pages: sources, landing, Bronze, Silver, Gold, validation, quality check, storage, refresh, failure/recovery.</td></tr>
            <tr><td>Code/config</td><td>Runnable ingestion + Bronze + Silver + Gold; validation and quarantine; quality check.</td></tr>
            <tr><td>Curated dataset</td><td>Definition (Gold or mart) + short data dictionary.</td></tr>
            <tr><td>Report</td><td>PBIX or TWBX (or link) with KPI, Revenue by Region, Revenue by Product, one filter, one measure.</td></tr>
            <tr><td>Report card</td><td>Purpose, audience, data source, refresh, one improvement.</td></tr>
            <tr><td>Runbook</td><td>At least 3 items: how to run; CSV missing; quality check fails.</td></tr>
            <tr><td>Pipeline summary</td><td>One paragraph for handoff.</td></tr>
        </table>
    </div>

    <h3>Success criteria (rubric)</h3>
    <div class="step-box">
        <ul>
            <li><strong>Design:</strong> Design doc clearly describes the flow and decisions; another reader can follow it.</li>
            <li><strong>Pipeline:</strong> On starter data, pipeline produces the expected Gold table; validation routes bad rows to quarantine; quality check is implemented and documented.</li>
            <li><strong>Report:</strong> Report connects to Gold; shows correct totals and breakdowns for the starter data; has at least one filter and one business measure.</li>
            <li><strong>Operability:</strong> Runbook covers run, missing source, and quality failure; pipeline summary enables handoff.</li>
        </ul>
    </div>

    <h3>By role</h3>
    <div class="step-box">
        <p><strong>Architect:</strong> Lead or review the design doc; present trade-offs (batch, storage, tooling) and failure/recovery strategy. Review one other team's design for single points of failure and scalability.</p>
        <p><strong>Engineer:</strong> Own implementation (ingestion, Bronze, Silver, Gold, validation, quality check); write the runbook and pipeline summary; confirm pipeline produces expected Gold on starter data.</p>
        <p><strong>Analyst:</strong> Own the report, report card, and data dictionary; trace one visual (e.g. Total Revenue) back to the Gold column and pipeline; present from a stakeholder perspective (question answered, refresh, one caveat).</p>
    </div>

    <div class="key-takeaways">
        <h4>Key Takeaways</h4>
        <ul>
            <li>Capstone is one fixed scenario (NorthStar Retail): same starter data, same expected Gold, same report targets so work is comparable.</li>
            <li>Five phases: Design doc → Implementation (ingest, Bronze, Silver, Gold) → Quality and curation → Report → Runbook and handoff. Each phase has a checkpoint.</li>
            <li>Deliverables: design doc, runnable code (with validation and quality check), curated dataset definition, report (PBIX/TWBX), report card, runbook (≥3 items), pipeline summary.</li>
            <li>Success = expected Gold on starter data, correct report numbers, and runbook that covers run, missing source, and quality failure.</li>
        </ul>
    </div>

    <h3>Real-World Applications</h3>
    <ul>
        <li><strong>Retail (this capstone):</strong> Sales CSV + product API → Bronze → Silver → Gold → quality check → report (revenue by region/product).</li>
        <li><strong>Same pattern elsewhere:</strong> Replace sources and grain (e.g. SaaS events, HR data); keep design doc, medallion, quality, runbook, and report card.</li>
    </ul>

    <div class="info-box"><strong>Relationship to other modules:</strong> Module 21 covers simulation (failure and recovery) and the holistic “business question → pipeline → report” flow; Module 22 is the roadmap and next steps.</div>
    <div class="quiz-section">
        <h3>Module Quiz</h3>
        <div class="quiz-question">
            <h4>Q1: What must the capstone pipeline span?</h4>
            <ul class="quiz-options"><li>A) Only ingestion</li><li>B) Ingestion → ETL (medallion) → management → storage → analytics</li></ul>
            <button class="show-answer-btn" id="btn-1" onclick="showAnswer(1)">Show Answer</button>
            <div class="quiz-answer" id="answer-1"><strong>Correct: B.</strong> Capstone covers the full pipeline lifecycle.</div>
        </div>
        <div class="quiz-question">
            <h4>Q2: What code deliverable is required?</h4>
            <ul class="quiz-options"><li>A) Only Bronze</li><li>B) At least Bronze → Silver → Gold (code or config)</li></ul>
            <button class="show-answer-btn" id="btn-2" onclick="showAnswer(2)">Show Answer</button>
            <div class="quiz-answer" id="answer-2"><strong>Correct: B.</strong> All three medallion layers must be implemented.</div>
        </div>
        <div class="quiz-question">
            <h4>Q3: Who typically owns the runbook?</h4>
            <ul class="quiz-options"><li>A) Only the architect</li><li>B) Engineer—runbooks document operational response</li></ul>
            <button class="show-answer-btn" id="btn-3" onclick="showAnswer(3)">Show Answer</button>
            <div class="quiz-answer" id="answer-3"><strong>Correct: B.</strong> Engineers document and maintain runbooks.</div>
        </div>
        <div class="quiz-question">
            <h4>Q4: What should the design doc include?</h4>
            <ul class="quiz-options"><li>A) Only tool names</li><li>B) Sources, layers, storage, refresh, and trade-offs</li></ul>
            <button class="show-answer-btn" id="btn-4" onclick="showAnswer(4)">Show Answer</button>
            <div class="quiz-answer" id="answer-4"><strong>Correct: B.</strong> Design doc captures architecture and decisions.</div>
        </div>
        <div class="quiz-question">
            <h4>Q5: What does the analyst deliver in the capstone?</h4>
            <ul class="quiz-options"><li>A) Only code</li><li>B) Report/dashboard and data request one-pager; present from stakeholder perspective</li></ul>
            <button class="show-answer-btn" id="btn-5" onclick="showAnswer(5)">Show Answer</button>
            <div class="quiz-answer" id="answer-5"><strong>Correct: B.</strong> Analyst owns the report and stakeholder narrative.</div>
        </div>
    </div>
    <script>function showAnswer(n){var a=document.getElementById('answer-'+n),b=document.getElementById('btn-'+n);if(a&&b){a.classList.add('show');b.disabled=true;b.textContent='Answer Revealed';}}</script>
<script>(function(){function sendHeight(){try{var body=document.body,html=document.documentElement;var h=Math.max(body.scrollHeight,body.offsetHeight,html.scrollHeight,html.offsetHeight,html.clientHeight||0);if(h<=0)return;var path=window.location.pathname||window.location.href||'';var m=path.match(/module-(\d+)\.html/);if(m)window.parent.postMessage({type:'setIframeHeight',height:h,moduleId:parseInt(m[1],10)},'*');}catch(e){}}sendHeight();setTimeout(sendHeight,100);setTimeout(sendHeight,400);setTimeout(sendHeight,1000);})();</script>
</body>
</html>
